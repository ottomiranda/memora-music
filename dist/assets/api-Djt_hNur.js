import{l as e}from"./utils-vendor-euKWYQ_X.js";import{C as r}from"./index-BX7dOzwF.js";import"./react-vendor-CNyCdty9.js";import"./radix-vendor-D0itpczX.js";import"./ui-vendor-bNvS7E9t.js";import"./i18n-vendor-CvzjU6Pd.js";let t=null;function o(e,r,t){return{code:e,message:r,details:t}}function s(s={}){if(t)return void r.warn("API interceptors already setup");const n=function(e,r){const t=(e&&e.trim().length>0?e:"/api").replace(/\/+$/,""),o=r?r.replace(/^\/+|\/+$/g,""):"";return t?o?`${t}/${o}`:t:o?`/${o}`:void 0}(s.baseUrl,s.version);t=e.create({baseURL:n,timeout:s.timeout??3e4,headers:{"Content-Type":"application/json"}}),t.interceptors.request.use(e=>{const t=function(){var e;try{const r=null==(e=window.useAuthStore)?void 0:e.getState();return(null==r?void 0:r.token)||null}catch(t){return r.warn("Failed to get auth token:",t),null}}(),o=`${Date.now()}-${Math.random().toString(36).substring(2,9)}`;return e.headers={...e.headers,"X-Trace-Id":o},t&&!e.skipAuth&&(e.headers.Authorization=`Bearer ${t}`),r.debug({msg:"API request",method:e.method,url:e.url,traceId:o}),e},e=>{const t=o("API_REQUEST_ERROR",e.message);return r.error({msg:"API request error",error:t}),Promise.reject(t)}),t.interceptors.response.use(e=>(r.debug({msg:"API response",status:e.status,url:e.config.url}),e),e=>{var t,s,n,i;const u=o("API_RESPONSE_ERROR",e.message,{config:e.config,status:null==(t=e.response)?void 0:t.status,data:null==(s=e.response)?void 0:s.data});return r.error({msg:"API response error",error:u}),401!==(null==(n=e.response)?void 0:n.status)||(null==(i=e.config)?void 0:i.skipAuth)||(window.location.href="/login"),Promise.reject(u)})}export{s as setupApiInterceptors};
