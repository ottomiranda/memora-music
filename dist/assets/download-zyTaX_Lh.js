const e=(e,r)=>{let o=e.toLowerCase();o=o.split("").filter(e=>{const r=e.charCodeAt(0);return r>=32&&r<=126||32===r}).join(""),o=(e=>e.replace(/[<>:"\\|?*]/g,"_").replace(/\s+/g,"_").replace(/[&+$~%'`@={}[\]]/g,"_"))(o),o+=".mp3";if(Buffer.from(o).length>255){const e=".mp3",r=255-Buffer.from(e).length;let n="",t=0;for(const a of o.slice(0,-4)){const e=Buffer.from(a).length;if(!(t+e<=r))break;n+=a,t+=e}o=n+e}return o},r=e=>e instanceof Error?{code:"DOWNLOAD_ERROR",message:e.message,details:{originalError:e}}:{code:"UNKNOWN_ERROR",message:"Erro desconhecido ao baixar arquivo",details:{originalError:e}},o=async(o,n,t)=>{try{const r=e(n||"download"),t=await(async e=>{if(e.type&&"application/octet-stream"!==e.type)return e;const r=await e.arrayBuffer();return new Blob([r],{type:"audio/mpeg"})})(o);return((e,r)=>{const o=URL.createObjectURL(e),n=document.createElement("a");n.href=o,n.download=r,document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>{URL.revokeObjectURL(o)},1e3)})(t,r),{success:!0,filename:r,size:t.size,mimeType:t.type}}catch(a){return{success:!1,filename:"",error:r(a)}}},n=async(e,n,t)=>{var a,s;const i={isDownloading:!0,progress:null,error:null};try{const r=await fetch(e,{...null==t?void 0:t.init,headers:{...null==(a=null==t?void 0:t.init)?void 0:a.headers,"Cache-Control":(null==t?void 0:t.preventCaching)?"no-cache":""}});if(!r.ok)throw new Error(`Falha ao baixar arquivo: ${r.status}`);const i=r.headers.get("content-length"),c=i?parseInt(i,10):0,l=null==(s=r.body)?void 0:s.getReader();if(!l)throw new Error("Não foi possível iniciar o download");let d=0;const u=[];for(;;){const{done:e,value:r}=await l.read();if(e)break;u.push(r),d+=r.length,c&&(null==t||t.onProgress)}const f=new Blob(u);return o(f,n)}catch(c){const e=r(c);return i.error=e,i.isDownloading=!1,{success:!1,filename:"",error:e}}finally{i.isDownloading=!1}};export{e as b,n as f};
